###################################################################
# DESCRIBE THE CONCEPT SETS
###################################################################
concept_sets_of_our_study_drugs <- c("Apixaban","Rivaroxaban","OtherDOACs", "ANTIAGGR", "NSAIDS", "INHIBVITK", "DOAC", "GASTRO", "STATINS", "ANTIDEPR", "HEPARIN", "ANTICANCER", "ANTIHYPERTEN", "ANTIDIAB")

concept_sets_of_our_study_diagnosis <- c("bleeding_narrow","IS","AMI","TIA","VTE","PE","DIC","FAT", "VE", "HF", "STROKE", "RENIMP", "HEPIMP", "DIAB","DEMENTIA")

# -concept_set_domains- is a 2-level list encoding for each concept set the corresponding data domain

concept_set_domains <- vector(mode="list")

for (concept_id in concept_sets_of_our_study_drugs) {
  concept_set_domains[[concept_id]] = "Medicines"
}

for (concept_id in concept_sets_of_our_study_drugs) {
  concept_set_domains[[concept_id]]="Diagnosis"
}


# -concept_set_codes_our_study- is a nested list, with 3 levels: foreach concept set, for each coding system of its data domain, the list of codes is recorded

concept_set_codes_our_study <- vector(mode="list")
concept_set_codes_our_study_excl <- vector(mode="list")

concept_set_codes_our_study[["Apixaban"]][["ATC"]] = c("B01AF02")
concept_set_codes_our_study[["Rivaroxaban"]][["ATC"]] = c("B01AF01")
concept_set_codes_our_study[["OtherDOACs"]][["ATC"]] = c("B01AE07", "B01AA", "B01AF03")


concept_set_codes_our_study[["bleeding_narrow"]][["ICD9"]] = c("455.2", "455.5", "455.8", "456.0", "456.20", "530.7", "530.8", "530.82", "531.0", "531.00", "531.01", "531.2", "531.20", "531.21", "531.4", "531.40", "531.41", "531.6", "531.60", "531.61", "532.0", "532.00", "532.01", "532.2", "532.20", "532.21", "532.4", "532.40", "532.41", "532.6", "532.60", "532.61", "533.0", "533.00", "533.01", "533.2", "533.20", "533.21", "533.4", "533.40", "533.41", "533.6", "533.60", "533.61", "534.0", "534.00", "534.01", "534.2", "534.20", "534.21", "534.4", "534.40", "534.41", "534.6", "534.60", "534.61", "535.01", "535.11", "535.21", "535.31", "535.41", "535.51", "535.61", "535.71", "537.83", "537.84", "562.02", "562.12", "562.03", "562.13", "568.81", "569.3", "569.85", "569.86", "578", "578.0", "578.1", "578.9", "430", "431", "432.0", "432.1", "432.9", "852.2", "852.4", "336.1", "363.6", "376.32", "377.42", "379.23", "423.0", "599.70", "866.01", "866.02", "866.11", "866.12", "786.9")

concept_set_codes_our_study[["IS"]][["ICD9"]] = c("346.6", "346.61", "346.62", "346.63", "433.01", "433.11", "433.21", "433.31", "433.81", "433.91", "434", "434.01", "434.11", "434.91")

concept_set_codes_our_study[["AMI"]][["ICD9"]] = c("410", "410.0", "410.00", "410.01", "410.1", "410.10", "410.11", "410.2", "410.20", "410.21", "410.3", "410.30", "410.31", "410.4", "401.40", "410.41", "410.5", "410.50", "410.51", "410.6", "410.60", "410.61", "410.7", "410.70", "410.71", "410.8", "410.80", "410.81", "410.9", "401.90", "401.91")

concept_set_codes_our_study[["VTE"]][["ICD9"]] = c("451.1", "451.19", "451.2", "453.2", "453.4", "453.4", "453.8", "453.9")

concept_set_codes_our_study[["TIA"]][["ICD9"]] = c("435", "435.8", "435.9")

concept_set_codes_our_study[["PE"]][["ICD9"]] = c("415.1", "415.19")

concept_set_codes_our_study[["DIC"]][["ICD9"]] = c("286.6")

# protocol version https://docs.google.com/document/d/1iDsfua3dngmNHm3Xy-y9wdqGxIvjGNpy/edit?tab=t.0
# Table 3.7.1

concept_set_codes_our_study[["FAT"]][["ICD9"]] = c("427.3", "427.31", "427.32") # atrial fibrillation
concept_set_codes_our_study[["VE"]][["ICD9"]] = c("451.8", "451.89", "453", "453.1", "453.9", "415.1", "415.19", "451.1", "451.19", "451.2", "453.2", "453.4", "453.4", "453.8", "453.9") # venous thromboembolism
concept_set_codes_our_study[["HF"]][["ICD9"]] = c("398.91", "402.01", "402.11", "402.91", "404.01", "404.03", "404.11", "404.13", "404.9", "428", "428", "428.1", "428.21", "428.23", "428.30", "428.31", "428.33", "428.40", "428.41", "428.43", "428.9") # heart failure
concept_set_codes_our_study[["STROKE"]][["ICD9"]] = c("346.6", "346.61", "346.62", "346.63", "430", "431", "432", "432.0", "432.1", "432.9", " 433.01", "433.11", "433.21", "433.31", "433.81", "433.91", "434", "434.01", "434.11", "434.91") # stroke, irrespective of haemorragic/ischaemic
concept_set_codes_our_study[["RENIMP"]][["ICD9"]] = c("403.91", "404.9", "404.92", "404.93", "582", "585", "585", "585.6", "585.9") # renal imairment
concept_set_codes_our_study[["HEPIMP"]][["ICD9"]] = c("571.2", "571.5 ", "070.0", "070.6 456.0", "456.2", "572.2", "572.3", "572.4") # Hepatic impairment
concept_set_codes_our_study[["DIAB"]][["ICD9"]] = c("250", "250.0", "250.00", "250.01", "250.02", "250.03", "250.1", "250.10", "250.11", "250.12", "250.13", "250.2", "250.20", "250.21", "250.22", "250.23", "250.3", "250.30", "250.31", "250.32", "250.33", "250.4", "250.40", "250.41", "250.42", "250.43", "250.5", "250.50", "250.51", "250.52", "250.53", "250.6", "250.60", "250.61", "250.62", "250.63", "250.7", "250.70", "250.71", "250.72", "250.73", "250.8", "250.80", "250.81", "250.82", "250.83", "250.9", "250.90", "250.91", "250.92", "250.93") # diabetes 1 or 2 
concept_set_codes_our_study[["CANCER1"]][["ICD9"]] = c("140", "140.0", "140.1", "140.2", "140.3", "140.4", "140.5", "140.6", "140.8", "140.9", "141", "141.0", "141.1", "141.2", "141.3", "141.4", "141.5", "141.6", "141.8", "141.9", "142", "142.0", "142.1", "142.2", "142.8", "142.9", "143", "143.0", "143.1", "143.8", "143.9", "144", "144.0", "144.1", "144.8", "144.9", "145", "145.0", "145.1", "145.2", "145.3", "145.4", "145.5", "145.6", "145.8", "145.9", "146", "146.0", "146.1", "146.2", "146.3", "146.4", "146.5", "146.6", "146.7", "146.8", "146.9", "147", "147.0", "147.1", "147.2", "147.3", "147.8", "147.9", "148", "148.0", "148.1", "148.2", "148.3", "148.8", "148.9", "149", "149.0", "149.1", "149.8", "149.9", "150", "150.0", "150.1", "150.2", "150.3", "150.4", "150.5", "150.8", "150.9", "151", "151.0", "151.1", "151.2", "151.3", "151.4", "151.5", "151.6", "151.8", "151.9", "152", "152.0", "152.1", "152.3", "152.8", "152.9", "153", "153.0", "153.1", "153.2", "153.3", "153.4", "153.5", "153.6", "153.7", "153.8", "153.9", "154", "154.0", "154.1", "154.2", "154.3", "154.8", "155", "155.0", "155.1", "155.2", "156", "156.0", "156.1", "156.2", "156.8", "156.9", "157", "157.0", "157.1", "157.2", "157.3", "157.4", "157.8", "157.9", "158", "158.0", "158.8", "158.9", "159", "159.0", "159.1", "159.8", "159.9,160", "160.0", "160.1", "160.2", "160.3", "160.4", "160.5", "160.8", "160.9", "161", "161.0", "161.2", "161.3", "161.8", "161.9", "162", "162.0", "162.2", "162.3", "162.4", "162.5", "162.8", "162.9163", "163.0", "163.1", "163.8", "163.9", "164", "164.0", "164.1", "164.2", "164.3", "164.8", "164.9", "165", "165.0", "165.8", "165.9", "170", "170.0", "170.1", "170.2", "170.3", "170.4", "170.5", "170.6", "170.7", "170.8", "170.9", "171", "171.0", "171.2", "171.3", "171.4", "171.5", "171.6", "171.7", "171.8", "171.9", "172", "172.0", "172.1", "172.2", "172.3", "172.4", "172.5", "172.6", "172.7", "172.8", "172.9", "173", "173.0", "173.00", "173.01", "173.02", "173.09", "173.1", "173.10", "173.11", "173.12", "173.19", "173.2", "173.20", "173.21", "173.22", "173.29", "173.3", "173.30", "173.31", "173.32", "173.39", "173.4", "173.40", "173.41", "173.42", "173.49", "173.5", "173.50", "173.51", "173.52", "173.59", "173.6", "173.60", "173.61", "173.62", "173.69", "173.7", "173.70", "173.71", "173.72", "173.79", "173.8", "173.80", "173.81", "173.82", "173.89", "173.9", "173.90", "173.91", "173.92", "173.99", "174", "174.0", "174.1", "174.2", "174.3", "174.4", "174.5", "174.6", "174.8", "174.9", "175", "175.0", "175.9", "176", "176.0", "176.1", "176.2", "176.3", "176.4", "176.5", "176.8", "176.9", "179", "180", "180.0", "180.1", "180.8", "180.9", "181", "182", "182.0", "182.1", "182.8", "183", "183.0", "183.2", "183.3", "183.4", "183.5", "183.8", "183.9", "184", "184.0", "184.1", "184.2", "184.3", "184.4", "184.8", "184.9", "185", "186", "186.0", "186.9", "187", "187.1", "187.2", "187.3", "187.4", "187.5", "187.6", "187.7", "187.8", "187.9", "188", "188.0", "188.1", "188.2", "188.3", "188.4", "188.5", "188.6", "188.7", "188.8", "188.9", "189", "189.0", "189.1", "189.2", "189.3", "189.4", "189.8", "189.9", "190", "190.0", "190.1", "190.2", "190.3", "190.4", "190.5", "190.6", "190.7", "190.8", "190.9", "191", "191.0", "191.1", "191.2", "191.3", "191.4", "191.5", "191.6", "191.7", "191.8", "191.9", "192", "192.0", "192.1", "192.2", "192.3", "192.8", "192.9", "193", "194", "194.0", "194.1", "194.2", "194.3", "194.4", "194.5", "194.6", "194.8", "194.9", "195", "195.0", "195.1", "195.2", "195.3", "195.4", "195.5", "195.8", "196", "196.0", "196.1", "196.2", "196.3", "196", "196.0", "196.1", "196.2", "196.3", "196.5", "196.6", "196.8", "196.9", "197", "197.0", "197.1", "197.2", "197.3", "197.4", "197.5", "197.6", "197.7", "197.8", "198", "198.0", "198.1", "198.2", "198.3", "198.4", "198.5", "198.6", "198.7", "198.8", "198.81", "198.82", "198.89", "199", "199.0", "199.1", "199.2", "200", "200.0", "200.00", "200.02", "200.03", "200.04", "200.05", "200.06", "200.07", "200.08", "200.1", "200.10. 200.11", "200.12", "200.13", "200.14") 
concept_set_codes_our_study[["CANCER2"]][["ICD9"]] = c("200.15", "200.16", "200.17", "200.18", "200.2", "200.20", "200.21", "200.22", "200.23", "200.24", "200.25", "200.26", "200.27", "200.28", "200.3", "200.30", "200.31", "200.32", "200.33", "200.34", "200.35", "200.36", "200.37", "200.38", "200.4", "200.40", "200.41", "200.42", "200.43", "200.44", "200.45", "200.46", "200.47", "200.48", "200.5", "200.50", "200.51", "200.52", "200.53", "200.54", "200.55", "200.56", "200.57", "200.58", "200.6", "200.60", "200.61", "200.62", "200.63", "200.64", "200.65", "200.66", "200.67", "200.68", "200.7", "200.70", "200.71", "200.72", "200.73", "200.74", "200.75", "200.76", "200.77", "200.78", "200.8", "200.80", "200.81", "200.82", "200.83", "200.84", "200.85", "200.86", "200.87", "200.88", "201", "201.0", "201.01", "201.02", "201.03", "201.04", "201.05", "201.06", "201.07", "201.08", "201.1", "201.10", "201.11", "201.12", "201.13", "201.14", "201.15", "201.16", "201.17", "201.18", "201.2", "201.20", "201.21", "201.22", "201.23", "201.24", "201.25", "201.26", "201.27", "201.28", "201.4", "201.40", "201.41", "201.42", "201.43", "201.44", "201.45", "201.46", "201.47", "201.48", "201.5", "201.50", "201.51", "201.52", "201.53", "201.54", "201.55", "201.56", "201.57", "201.58", "201.6", "201.60", "201.61", "201.62", "201.63", "201.64", "201.65", "201.66", "201.67", "201.68", "201.7", "201.70", "201.71", "201.72", "201.73", "201.74", "201.75", "201.76", "201.77", "201.78", "201.9", "201.90", "201.91", "201.92", "201.293", "201.94", "201.95", "201.96", "201.97", "201.98", "202", "202.0", "202.00", "202.01", "202.02", "202.03", "202.04", "202.05", "202.06", "202.07", "202.08", "202.1", "202.10", "202.11", "202.12", "202.13", "202.14", "202.15", "202.16", "202.17", "202.18", "202.2", "202.20", "202.21", "202.22", "202.23", "202.24", "202.25", "202.26", "202.27", "202.28", "202.3", "202.30", "202.31", "202.32", "202.33", "202.34", "202.35", "202.36", "202.37", "202.38", "202.4", "202.40", "202.41", "202.42", "202.43", "202.44", "202.4", "202.46", "202.47", "202.48", "202.5", "202.50", "202.51", "202.52", "202.53", "202.54", "202.55", "202.56", "202.57", "202.58", "202.6", "202.60", "202.61", "202.62", "202.63", "202.64", "202.65", "202.66", "202.67", "202.68", "202.7", "202.70", "202.71", "202.72", "202.73", "202.74", "202.75", "202.76", "202.77", "202.78", "202.8", "202.80", "202.81", "202.82", "202.83", "202.84", "202.85", "202.86", "202.87", "202.88", "202.9", "202.90", "202.91", "202.92", "202.93", "202.94", "202.95", "202.96", "202.97", "202.98", "203", "203.0", "203.00", "203.01", "203.02", "203.1", "203.10", "203.11", "203.12", "203.8", "203.80", "203.81", "203.83", "204", "204.0", "204.00", "204.01", "204.02", "204.1", "204.10", "204.11", "204.12", "204.2", "204.20", "204.21", "204.22", "204.8", "204.80", "204.81", "204.82", "204.9", "204.90", "204.91", "204.92", "205", "205.0", "205.00", "205.01", "205.02", "205.1", "205.10", "205.11", "205.12", "205.2", "205.20", "205.21", "205.22", "205.3", "205.30", "205.31", "205.32", "205.8", "205.80", "205.81", "205.82", "205.9", "205.90", "205.91", "205.92", "206", "206.0", "206.00", "206.01", "206.02", "206.1", "206.10", "206.11", "206.12", "206.2", "206.20", "206.21", "206.22", "206.8", "206.80", "206.81", "206.82", "206.9", "206.90", "206.91", "206.92", "207", "207.0", "207.00", "207.01", "207.02", "207.1", "207.10", "207.11", "207.12", "207.2", "207.20", "207.21", "207.22", "207.8", "207.80", "207.81", "207.82", "208", "208.0", "208.00", "208.01", "208.02", "208.1", "208.10", "208.11", "208.12", "208.2", "208.20", "208.21", "208.22", "208.8", "208.80", "208.81", "208.82", "208.9", "208.90", "208.91", "208.92", "209", "209.0", "209.00", "209.01", "209.02", "209.03", "209.1", "209.10", "209.11", "209.12", "209.13", "209.14", "209.15", "209.16", "209.17") 
concept_set_codes_our_study[["CANCER3"]][["ICD9"]] = c("209.2", "209.20", "209.21", "209.22", "209.23", "209.24", "209.25", "209.26", "209.27", "209.29", "209.3", "209.30", "209.31", "209.32", "209.33", "209.34", "209.35", "209.36", "209.4", "209.40", "209.41", "209.42", "209.43", "209.5", "205.50", "209.51", "209.52", "209.53", "209.54", "209.55", "209.56", "209.57", "209.6", "209.60", "209.61", "209.62", "209.63", "209.64", "209.65", "209.66", "209.67", "209.69", "209.7", "209.70", "209.71", "209.72", "209.73", "209.74", "209.75", "209.79", "210", "210.0", "210.1", "210.2", "210.3", "210.4", "210.5", "210.6", "210.7", "210.8", "210.9", "211", "211.0", "211.1", "211.2", "211.3", "211.4", "211.5", "211.6", "211.7", "211.8", "211.9", "212", "212.0", "212.1", "212.2", "212.3", "212.4", "212.5", "212.6", "212.7", "212.8", "212.9", "213", "213.0", "213.1", "213.2", "213.3", "213.4", "213.5", "213.6", "213.7", "213.8", "213.9", "214", "214.0", "214.1", "214.2", "214.3", "214.4", "214.8", "214.9", "215", "215.0", "215.2", "215.3", "215.4", "215.6", "215.7", "215.8", "215.9", "216", "216.0", "216.1", "216.2", "216.3", "216.4", "216.5", "216.6", "216.7", "216.8", "216.9", "217", "218", "218.0", "218.1", "218.2", "218.9", "291", "219.0", "219.1", "219.8", "219.9", "220", "221", "221.0", "221.1", "221.2", "221.8", "221.9", "222", "222.0", "222.1", "222.2", "222.3", "222.4", "222.8", "222.9", "223", "223.0", "223.1", "223.2", "223.3", "223.8", "223.81", "223.89", "223.9", "224", "224.0", "224.1", "224.2", "224.3", "224.4", "224.5", "224.6", "224.7", "224.8", "224.9", "225", "225.0", "225.1", "225.2", "225.3", "225.4", "225.8", "225.9", "226", "227", "227.0", "227.1", "227.2", "227.3", "227.4", "227.5", "227.6", "227.8", "227.9", "228", "228.0", "228.00", "228.01", "228.02", "228.03", "228.04", "228.09", "228.1", "229", "229.0", "229.8", "229.9", "230", "230.0", "230.1", "230.2", "230.3", "230.4", "230.5", "230.6", "230.7", "230.8", "230.9", "231", "231.0", "231.1", "231.2", "231.8", "231.9", "232", "232.0", "232.1", "232.2", "232.3", "232.4", "232.5", "232.6", "232.7", "232.8", "232.9", "233", "233.0", "233.1", "233.2", "233.3", "233.30", "233.31", "233.32", "233.39", "233.4", "233.5", "233.6", "233.7", "233.9", "234", "234.0", "234.8", "234.9", "235", "235.0", "235.1", "235.2", "235.3", "235.4", "235.6", "235.7", "235.8", "235.9", "236", "236.0", "236.1", "236.2", "236.3", "236.4", "236.5", "236.6", "236.7", "236.9", "236.90", "236.91", "236.99", "237", "237.0", "237.1", "237.2", "237.3", "237.4", "237.5", "237.6", "237.7", "237.70", "237.71", "237.72", "237.73", "237.79", "237.9", "238", "238.0", "238.1", "238.2", "238.3", "238.4", "238.5", "238.6", "238.7", "238.71", "238.72", "238.73", "238.74", "238.75", "238.76", "238.77", "238.79", "238.8", "238.9", "239", "239.0", "239.1", "239.2", "239.3", "239.4", "239.5", "239.6", "239.7", "239.8", "239.81", "239.89", "239.9") # cancer
concept_set_codes_our_study[["DEMENTIA"]][["ICD9"]] = c("290, 290.0, 290.1, 290.10, 290.11, 290.12, 290.13, 290.2, 290.20, 290.21, 290.3, 290.4, 290.40, 290.21, 290.42, 290.43, 290.8, 290.9, ,291, 291.0, 291.1, 291.2, 291.3, 291.4, 291.5, 291.8, 291.81, 291.82, 291.89, 291.9,  292, 292.0, 292.1, 292.11, 292.12, 292.2, 292.8, 292.81, 292.82, 292.83, 292.84, 292.85, 292.89, 292.9, 294, 294.0, 294.1, 294.10, 294.11, 294.2, 294.20, 294.21, 294.8, 294.9, 331, 331.0, 331.1, 331.11, 331.19, 331.2, 331.3, 331.4, 331.5, 331.6, 331.7, 331.8, 331.81, 331.82, 331.83, 331.89, 331.9") # dementia 

concept_set_codes_our_study[["CANCER"]][["ICD9"]] <- c(concept_set_codes_our_study[["CANCER1"]][["ICD9"]],concept_set_codes_our_study[["CANCER2"]][["ICD9"]],concept_set_codes_our_study[["CANCER3"]][["ICD9"]])

concept_set_codes_our_study[["ANTIAGGR"]][["ATC"]] = c("B01AC") # Antiaggreganti piastrinici 
concept_set_codes_our_study[["NSAIDS"]][["ATC"]] = c("M01A") # Antinfiammatori non steroidei 
concept_set_codes_our_study[["INHIBVITK"]][["ATC"]] = c("B01AA") # Inibitori della vitamina K
concept_set_codes_our_study[["DOAC"]][["ATC"]] = c("B01AF01", "B01AF02", "B01AE07", "B01AF03") # 
concept_set_codes_our_study[["GASTRO"]][["ATC"]] = c("A02B") # Inibitori della secrezione gastrica
concept_set_codes_our_study[["STATINS"]][["ATC"]] = c("C10AA") # Statine
concept_set_codes_our_study[["ANTIDEPR"]][["ATC"]] = c("N06A") # Antidepressivi
concept_set_codes_our_study[["HEPARIN"]][["ATC"]] = c("B01AB") # Eparina
concept_set_codes_our_study[["ANTICANCER"]][["ATC"]] = c("L01") # Antitumorali
concept_set_codes_our_study[["ANTIHYPERTEN"]][["ATC"]] = c("C02", "C03", "C07", "C08", "C09") # Antiipertensivi
concept_set_codes_our_study[["ANTIDIAB"]][["ATC"]] = c("A10") # Antidiabetici

